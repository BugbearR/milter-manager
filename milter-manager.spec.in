Summary: A milter to use milters effectively
Name: milter-manager
Version: @VERSION@
Release: 1
License: GPLv3+, LGPL3+, AGPL3+, GFDL, Public Domain
URL: http://milter-manager.sourceforge.net/
Group: Applications/Internet
Source0: milter-manager-@VERSION@.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
BuildRequires: libtool
BuildRequires: intltool
BuildRequires: gcc
BuildRequires: glib2-devel
BuildRequires: ruby
BuildRequires: ruby-devel
BuildRequires: ruby-glib2-devel
Requires: glib2
Requires: ruby
Requires: ruby-glib2
Requires: ruby-rrdtool
Requires(post): chkconfig
Requires(preun): chkconfig

%description
milter manager administrates milters instead of MTA to reduce milter
administration cost and combine milters flexibly.

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
rm -rf %{buildroot}
make install DESTDIR=%{buildroot}

mkdir -p %{buildroot}%{_initrddir}
install -m 755 data/init.d/redhat/milter-manager %{buildroot}%{_initrddir}/milter-manager
install -m 644 data/init.d/redhat/sysconfig/milter-manager %{buildroot}%{_sysconfdir}/milter-manager.dist
if [ ! -e %{buildroot}%{_sysconfdir}/milter-manager ]; then
    cp %{buildroot}%{_sysconfdir}/milter-manager.dist %{buildroot}%{_sysconfdir}/milter-manager
fi

mkdir -p %{buildroot}%{_localstatedir}/run/milter-manager/

%clean
rm -rf %{buildroot}

%post
/sbin/chkconfig --add milter-manager

%preun
if [ $1 = 0 ] ; then
    /sbin/service milter-manager stop > /dev/null 2>&1
    /sbin/chkconfig --del milter-manager
fi

%postun
if [ $1 -ge 1 ] ; then
    /sbin/service milter-manager condrestart > /dev/null 2>&1
fi

%files
%defattr(-, root, root, -)
%doc ChangeLog ChangeLog.toolkit README README.ja NEWS NEWS.ja README.ja TODO license/*.txt
%{_bindir}/*
%{_libexecdir}/*
%{_mandir}/*/*
%{_mandir}/ja*/*/*
%{_initrddir}/milter-manager
%config %{_sysconfdir}/milter-manager
%attr(0750, daemon, daemon) %dir %{_localstatedir}/run/milter-manager/

%changelog
* Thu Apr 16 2009 Kouhei Sutou <kou@clear-code.com>
- (1.0.0-1)
- initial stable release
