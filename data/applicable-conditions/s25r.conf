# -*- ruby -*-

define_applicable_condition("S25R") do |condition|
  condition.description = "Selective SMTP Rejection"

  whitelist = [/\.google\.com\z/]
  condition.define_connect_stopper do |context, host, address|
    case host
    when *whitelist
      true
    when "unknown",
      /\A\[.+\]\z/,
      /\A[^.]*\d[^\d.]+\d.*\./,
      /\A[^.]*\d{5}/,
      /\A(?:[^.]+\.)?\d[^.]*\.[^.]+\..+\.[a-z]/i,
      /\A[^.]*\d\.[^.]*\d-\d/,
      /\A[^.]*\d\.[^.]*\d\.[^.]+\..+\./,
      /\A(?:dhcp|dialup|ppp|[achrsvx]?dsl)[^.]*\d/i
      false
    else
      true
    end
  end
end
